# 智谱AI意图识别说明

## 概述

**重要更新**：本项目已移除简单匹配功能，现在仅支持API方式进行意图识别。

本项目使用：
- **智谱AI（GLM-4）**：使用大语言模型进行智能意图识别（**唯一支持的方式**）

## 历史说明

本项目之前支持两种意图识别方式：
1. **智谱AI（GLM-4）**：使用大语言模型进行智能意图识别
2. **简单匹配**：基于关键词的匹配算法（**已移除**）

根据项目要求，本项目现在仅使用API进行意图识别，不再支持简单匹配模式。

## 核心差异

### 1. 工作原理

#### 智谱AI（大模型）
- **工作原理**：将用户输入和所有可用意图发送给大语言模型
- **处理方式**：模型理解语义，分析用户意图，返回最匹配的意图名称
- **优势**：能理解自然语言、同义词、上下文

#### 简单匹配
- **工作原理**：提取用户输入中的关键词，与DSL脚本中定义的模式进行匹配
- **处理方式**：
  1. 首先尝试完全匹配或包含匹配
  2. 如果失败，提取关键词进行相似度计算
- **优势**：速度快，无需网络，离线可用

### 2. 实际效果对比

#### 场景1：标准关键词输入
```
用户输入："查询订单"
- 智谱AI：✅ 识别为"订单查询"
- 简单匹配：✅ 识别为"订单查询"
```
**结论**：两者都能正确识别

#### 场景2：自然语言表达
```
用户输入："我想查一下我的订单在哪里"
- 智谱AI：✅ 识别为"订单查询"（理解"查订单"的语义）
- 简单匹配：✅ 识别为"订单查询"（匹配到"订单"关键词）
```
**结论**：都能识别，但大模型理解更深层语义

#### 场景3：同义词/近义词
```
用户输入："我要退货"
DSL脚本中定义："退款" or "退货" or "申请退款"
- 智谱AI：✅ 识别为"退款申请"（理解"退货"和"退款"是同义词）
- 简单匹配：✅ 识别为"退款申请"（匹配到"退货"关键词）
```
**结论**：都能识别，因为DSL中已定义"退货"

#### 场景4：未定义的同义词
```
用户输入："我想退钱"
DSL脚本中定义："退款" or "退货" or "申请退款"（没有"退钱"）
- 智谱AI：✅ 识别为"退款申请"（理解"退钱"和"退款"是同义词）
- 简单匹配：❌ 可能无法识别或识别错误（"退钱"不在关键词列表中）
```
**结论**：大模型优势明显，能理解未定义的同义词

#### 场景5：模糊表达
```
用户输入："帮我看看"
- 智谱AI：✅ 可能识别为"订单查询"（根据上下文理解）
- 简单匹配：❌ 无法识别（没有匹配的关键词）
```
**结论**：大模型能处理模糊表达

#### 场景6：复杂句子
```
用户输入："我的订单31415926现在是什么状态，能帮我查一下吗"
- 智谱AI：✅ 识别为"订单查询"（理解核心意图是查询订单状态）
- 简单匹配：✅ 识别为"订单查询"（匹配到"订单"关键词）
```
**结论**：都能识别，但大模型能更好地忽略无关信息

## 大模型的作用和价值

### 1. 语义理解能力
- **理解同义词**：即使DSL脚本中没有定义"退钱"，也能理解它与"退款"是同义词
- **理解上下文**：能根据对话上下文理解用户意图
- **理解意图**：不仅匹配关键词，还理解用户真正想做什么

### 2. 灵活性
- **减少维护成本**：不需要在DSL脚本中列出所有可能的表达方式
- **支持自然对话**：用户可以用更自然的方式表达需求
- **适应性强**：能处理各种变体表达

### 3. 用户体验
- **更智能**：用户感觉系统"理解"他们，而不是机械匹配
- **更友好**：支持口语化、非正式的表达
- **更准确**：减少误识别

## 简单匹配的优势

### 1. 性能
- **速度快**：本地计算，毫秒级响应
- **无网络依赖**：离线可用
- **无成本**：不需要API调用费用

### 2. 可靠性
- **可预测**：结果完全基于规则，易于调试
- **稳定**：不受网络、API限制影响
- **可控**：完全控制匹配逻辑

### 3. 适用场景
- **关键词明确**：当用户输入与DSL定义高度匹配时
- **性能要求高**：需要极低延迟的场景
- **离线环境**：无法连接网络的场景

## 实际使用建议

### 推荐使用智谱AI的场景
1. **面向最终用户的产品**：需要更好的用户体验
2. **表达方式多样**：用户可能用各种方式表达同一意图
3. **需要理解语义**：不仅仅是关键词匹配
4. **有API预算**：可以承担API调用成本

### 推荐使用简单匹配的场景
1. **开发/测试环境**：快速测试，无需配置API
2. **性能敏感场景**：需要极低延迟
3. **离线环境**：无法连接网络
4. **关键词明确**：用户输入与DSL定义高度一致

## 本项目中的实现

### API驱动机制
本项目要求使用API进行意图识别：
1. **必须使用智谱AI**：系统仅支持API方式进行意图识别
2. **必须配置API Key**：未配置API Key时系统将无法启动
3. **无降级机制**：不再支持简单匹配作为备用方案

### 使用方式
```bash
# 使用智谱AI（默认，必须配置API Key）
python src/cli.py scripts/order_query.dsl

# 明确指定使用智谱AI
python src/cli.py scripts/order_query.dsl --llm-client zhipuai

# 注意：simple 模式已不再支持
# 本项目要求使用API进行意图识别，必须配置 ZHIPUAI_API_KEY
```

## 总结

| 特性 | 智谱AI | 简单匹配 |
|------|--------|----------|
| 语义理解 | ✅ 强 | ❌ 弱 |
| 同义词识别 | ✅ 自动 | ⚠️ 需手动定义 |
| 模糊表达处理 | ✅ 好 | ❌ 差 |
| 速度 | ⚠️ 较慢（网络请求） | ✅ 快（本地计算） |
| 成本 | ⚠️ 需要API费用 | ✅ 免费 |
| 可靠性 | ⚠️ 依赖网络 | ✅ 高 |
| 用户体验 | ✅ 好 | ⚠️ 一般 |

**结论**：大模型的主要价值在于**提升用户体验**和**减少维护成本**，让系统更智能、更灵活。简单匹配则适合**性能要求高**和**离线环境**的场景。本项目通过自动降级机制，结合了两者的优势。

